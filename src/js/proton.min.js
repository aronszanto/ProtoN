var proton=function(){"use strict";const t={PrimNull:0,PrimString:1,PrimInt:2,PrimFloat:3,PrimBool:4,ConPair:5,ConList:6,ConObject:7},e=3,r=127,n=32767,i=2147483647,s=4294967296;var u,o,f,a,l,h,p,b,c;return u=0,o=1,f=2,a=function(t){var e;do{e=(t%2?"1":"0")+(e||""),t>>=1}while(t);return e},l=function(t){return Number(t).toString(16)},h=function(t){return a(Math.abs(t)).length},p=function(t){return(1<<t)-1},b=function(t){return String.fromCharCode(t)},function(t){return String(t).charCodeAt(0)},c=function(){function t(t,e){var r,n;for(null==t&&(t=""),null==e&&(e=[]),this.buf=e.slice(),r=0,n=t.length;r<n;++r)this._bufwrite(t.charCodeAt(r))}t.displayName="BitString";var e=t.prototype;return e.buf=null,e._pos=-1,e._spill=0,e._spillen=0,e._peek=0,e._peeklen=0,e.size=function(){return this.buf.length+(this._spillen?1:0)},e.bitsize=function(){return 8*this.buf.length+this._spillen},e._bufwrite=function(t){return-1===this._pos?this.buf.push(t):(this.buf[this._pos]=t,++this._pos>=this.buf.length&&(this._pos=-1)),this},e.writebits=function(t,e){var r,n;for(e=e||h(t),r=this._spill<<e|t,e+=this._spillen;e>=8;)e-=8,n=r>>e,r&=p(e),this._bufwrite(n);return this._spill=r,this._spillen=e,this},e.flush=function(){var t;return t=this._spill,this._spillen&&(t<<=8-this._spillen,this._bufwrite(t)),this._spill=0,this._spillen=0,this},e.truncate=function(){return this.buf=[],this._pos=-1,this._spill=0,this._spillen=0,this._peek=0,this._peeklen=0,this},e._bufseek=function(t,e){var r;switch(null==e&&(e=u),e){case 1:r=this._pos+t;break;case 2:r=this.buf.length+t;break;default:r=t}return this._pos=r>=this.buf.length?-1:Math.max(0,r),this},e.seek=function(t,e){return null==e&&(e=u),this.flush(),this._peek=0,this._peeklen=0,this._bufseek(t,e),this},e.tell=function(){return-1===this._pos?this.buf.length:this._pos},e._nextbyte=function(){var t;return-1===this._pos?null:(t=this.buf[this._pos++],this._pos>=this.buf.length&&(this._pos=-1),t)},e.readbits=function(t){var e,r,n;if(0==t)return 0;for(e=this._peeklen,r=this._peek;e<t&&null!=(n=this._nextbyte());)e+=8,r=r<<8|n;return e>t?(this._peeklen=e-t,this._peek=r&p(this._peeklen),r>>=this._peeklen):(this._peeklen=0,this._peek=0),e?r:null},e.peek=function(t){var e,r,n,i,s;for(e=0,r=this._peeklen,n=this._peek,s=this._pos;r<t&&null!=(i=this._nextbyte());)e+=1,r+=8,n=n<<8|i;return 0==r?null:(r>t&&(n>>=r-t),e&&this._bufseek(s),n)},e.hasMore=function(){return null!=this.peek(1)},e.each=function(t,e){return null==e&&(e=this),this.buf.forEach(t,e),this},e.map=function(t,e){return null==e&&(e=this),this.buf.map(t,e)},e.reduce=function(t,e,r){return null==r&&(r=this),t=t.bind(this),this.buf.reduce(t,e)},e.bytearray=function(){return this.flush().buf.slice()},e.bin=function(t){return null==t&&(t=""),this.flush().buf.map(a).join(t)},e.hex=function(){return this.flush().buf.map(l).join("")},e.number=function(){return this.flush(),this.reduce(function(t,e){return t<<8|e})},e.dump=function(){return this.buf.map(b).join("")+(this._spillen?b(this._spill<<8-this._spillen):"")},e.repr=function(t){return null==t&&(t=!0),"BitString("+(t?"buf="+this.dump():"len(buf)="+this.buf.length)+", spill["+this._spillen+"]="+a(this._spill)+", tell="+this.tell()+", peek["+this._peeklen+"]="+a(this._peek)+")"},e.toString=function(){return this.flush().dump()},t}(),c.SEEK_ABSOLUTE=u,c.SEEK_RELATIVE=o,c.SEEK_FROM_EOF=f,{encode:function(u){function o(u,f){function a(t,e,r){var n=unescape(encodeURIComponent(t));e.writebits(n.length,r);for(var i=0;i<n.length;i++)e.writebits(n.charCodeAt(i),8);return e}function l(t,e){a(t,e,16)}if(null===u||void 0===u)return f.writebits(t.PrimNull,e);if("string"==typeof u)return f.writebits(t.PrimString,e),l(u,f);if("boolean"==typeof u)return f.writebits(t.PrimBool,e),f.writebits(u?1:0,1);if(Number.isInteger(u)){f.writebits(t.PrimInt,e);var h=Math.abs(u);if(h<=r){f.writebits(0,2);var p=new DataView(new ArrayBuffer(1));p.setInt8(0,u,!1),f.writebits(p.getUint8(0,!1),8)}else if(h<=n){f.writebits(1,2);var p=new DataView(new ArrayBuffer(2));p.setInt16(0,u,!1),f.writebits(p.getUint16(0,!1),16)}else if(h<=i){f.writebits(2,2);var p=new DataView(new ArrayBuffer(4));p.setInt32(0,u,!1);for(var b=0;b<4;b+=2)f.writebits(p.getUint16(b,!1),16)}else{f.writebits(3,2);for(var c=4294967295&u,w=(u-c)/s,_=[w>>>16,65535&w,c>>>16,65535&c],b=0;b<_.length;b++)f.writebits(_[b],16)}return f}if("number"==typeof u){if(f.writebits(t.PrimFloat,e),(u+"").length<8)f.writebits(0,1),function(t,e){a(t,e,3)}(u+"",f);else{f.writebits(1,1);var p=new DataView(new ArrayBuffer(8));p.setFloat64(0,u,!1);for(var b=0;b<8;b+=2)f.writebits(p.getUint16(b,!1),16)}return f}if("[object Array]"===Object.prototype.toString.call(u)){f.writebits(t.ConList,e),f.writebits(u.length,16);for(var b=0;b<u.length;b++)f=o(u[b],f);return f}if(u===Object(u))return f.writebits(t.ConObject,e),f.writebits(Object.keys(u).length,16),Object.keys(u).forEach(function(r){f.writebits(t.ConPair,e),f=l(r,f),f=o(u[r],f)}),f;throw new Error("Error encoding object into ProtoN.")}if("[object Array]"!==Object.prototype.toString.call(u)&&u!==Object(u))throw new TypeError("ProtoN Encoding Requires a List or Object.");var f=new c;f.writebits(1,2);var a=o(u,f);return new Uint8Array(a.bytearray())},decode:function(r){function n(){throw new Error("Malformed ProtoN message.")}function i(t){return t.readbits(e)}function u(t){return t.readbits(16)}function o(t,e){for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t.readbits(8));return decodeURIComponent(escape(r))}function f(t){return o(t,u(t))}function a(t){return o(t,t.readbits(3))}function l(r){var n=r.peek(e);return n==t.ConList||n==t.ConObject}function h(r){var i=r.readbits(e);if(i==t.PrimNull)return null;if(i==t.PrimString)return f(r);if(i==t.PrimInt){var u=Math.pow(2,r.readbits(2)+3);if(64==u){for(var o=new DataView(new ArrayBuffer(8)),l=0;l<4;l++)o.setUint16(2*l,r.readbits(16),!1);var h=o.getInt32(0,!1);if(h>1048575)return 1/0;var p=o.getInt32(4,!1);return h|=0,h?h*s+p:p}for(var b=u/8,o=new DataView(new ArrayBuffer(b)),l=0;l<b;l++)o.setUint8(l,r.readbits(8),!1);if(8==u)return o.getInt8(0,!1);if(16==u)return o.getInt16(0,!1);if(32==u)return o.getInt32(0,!1);n()}else{if(i==t.PrimFloat){if(r.readbits(1)){for(var o=new DataView(new ArrayBuffer(8)),l=0;l<4;l++)o.setUint16(2*l,r.readbits(16),!1);return o.getFloat64(0,!1)}return parseFloat(a(r))}if(i==t.PrimBool)return!!r.readbits(1);n()}}function p(r){var s=i(r);if(s==t.ConList){for(var o=u(r),a=[],b=0;b<o;b++)l(r)?a.push(p(r)):a.push(h(r));return a}if(s==t.ConObject){for(var c=u(r),w={},b=0;b<c;b++){r.readbits(e)!=t.ConPair&&n();var _=f(r);l(r)?w[_]=p(r):w[_]=h(r)}return w}n()}if(!(r instanceof Uint8Array))throw new TypeError("proton.decode argument must be Uint8Array");var b=new c("",r);if(b.seek(0),1!=b.readbits(2))throw new Error("Unsupported ProtoN version.");return p(b)},get:function(t,e,r){var n=new XMLHttpRequest;t+="?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&"),n.open("GET",t),n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE&&r){var t=null,e=n.response;if(e){var i=new Uint8Array(e);t=proton.decode(i)}r(t)}},n.send(e)},post:function(t,e,r){var n=proton.encode(e),i=new XMLHttpRequest;i.open("POST",t),i.setRequestHeader("Content-Type","proton"),i.responseType="arraybuffer",i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE&&r){var t=null,e=i.response;if(e){var n=new Uint8Array(e);t=proton.decode(n)}r(t)}},i.send(n)}}}();